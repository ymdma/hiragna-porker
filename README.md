  # ひらがな DE ポーカー

<div display="flex" align="center">
  <img src="./public/image/start.png" width="50%">
</div>

  ## ひらがな DE ポーカーとは

元となるゲームは、数年前にTwitterで話題になったゲーム「ひらがなポーカー」。<br>
それは、ひらがな五十音(47枚)のカードを使ったゲームです。<br>

ランダムで配られた５枚のカードを手札として、面白い言葉になるように交換・並べ替えを行い、<br>
できた”ことば”をプレイヤー同士発表し合います。

勝敗は「面白い方が勝ち！」というユニークなゲームです。

<br>

  ### サイトURL:<br>
:link: [https://hiragana-de-porker.web.app/](https://hiragana-de-porker.web.app/)

<br>

  ### 制作・動作確認環境: <br>
:computer: Mac GoogleChrome(ver: 最新) <br>
:iphone: iOS 13 GoogleChrome,safari (画面サイズ: iPhone6/7/8~)<br>
<br>
＊PCでのプレイ時、ブラウザ画面の縦幅640px以上推奨<br>
＊スマホでは縦のみ対応。横置き時は「縦でプレイしてください」というダイアログが出ます。<br>
<br>


<br>

***

<br>

  ## 制作背景

ライブラリを使わないJavaScript、Webpack4を用いたコンパイル、Sassや、FLOCSSを用いた(意識)したCSS等、フロントエンド系の諸技術を使用した習作として製作しました。<br>

(ごく簡単なもの以外では) 始めてJavaScriptを使ったゲームを作りましたが、"楽しく遊べるもの"の完成を目指しました。 <br>
<br>
<br>

***

<br>


  ## なぜこのゲームを作ろうと思ったか

  - 「やってみたいね」と言う話になったが既製品でアプリが見つからなかったこと。<br>
  - 検索すると、 [*** アプリ] のように表示されるが、どうやら既製品がないこと。<br>
  - 流行ったのは数年前ですが、前とはいえ普遍的な面白さがあること。<br>
  - ゲームのルールには著作権が適用されないこと。<br>


<br>
<br>


  # ゲームの流れ

  ## 先行するプレーヤーを決める<br>
  「ひらがなDEポーカー」は、2人のプレーヤーで遊ぶ仕様になっています。

  プリセットされている2つのアバター:chicken: :dog:のうちいずれかを選択し、先行するプレーヤーを決めます。

<br>

  ## カードを交換する
  先行するプレーヤーから行動を開始します。

  まずは、ランダムに(被りなく)配られる、５枚のカードを確認します。（以降これを手札と呼びます）
  手札の文字達からイメージを膨らませ、交換したいカードがあれば、「カードの交換」を行います。
  (交換は最大で４枚まで行えます。)

   なお、交換して不要になったカードは「交換済みカード」として表示されます。

<div display="flex" align="center">
  <img src="https://i.gyazo.com/0b638fb57070ea53c58f34a2d2a04c6b.gif" width="50%">
</div>

  これ以上交換の必要がないと考えた場合、また、交換を終えた時には、「並び替える」ボタンを押して並び替えの画面に移ります。

<br>

  ## 手札を並び替える
  手札が揃ったら並び替えに移ります。

  並び替え画面に用意されている２組のカード達のうち、上段が"元の並び"の手札、下段が"並び替え後"の手札となります。

  まずは、上段の手札を並ばせたい順番にクリックすることで、下段に新しい並びの手札が作成されてゆきます。

<div display="flex" align="left">
  <img src="./public/image/sort.png" width="30%">
</div>
  並びを直したい時（また、文字が被ってしまった時）には、画面下部の「もう一回並び替える」を押すことで、始めからやり直すことができます。
<div display="flex" align="right">
  <img src="https://i.gyazo.com/30559106526d41368c8bb54b31a7749a.gif" width="30%">
</div>
  思った通りに並び替えたら、「次へ進む」を押します。

<br>
<br>

   ### 濁点・半濁点・小文字の変換

  始めに配られるカードには濁点・半濁点のついた文字や、小文字を含んでいません。<br>
  それらは、このタイミングで任意につけることができます。<br>
  下段の、並び替えたカードのうち、変換可能な文字をクリックし、表示された候補をクリックすることで選択します。

<br>
<br>

<div display="flex" align="center">
  <img src="https://i.gyazo.com/95dda57feff68a06472b4e7915be6677.gif" width="40%">
</div>

  ## コメントを添える
  このウィンドウでは、完成した言葉に対して、任意のコメントを添えることができます、

  例えばTwitterで、面白い写真をtweetする際に、一言ボケコメントを添えて笑いを誘うように、気の利いた一言コメントを添えたり。
  または、なんでもない言葉でも詳しいシチュエーションを説明して面白くしてみたり。それぞれの発想で活用してください。

<div display="flex" align="center">
  <img src="./public/image/comment.png" width="40%">
</div>

  使い方としては、
  ・テキストエリアを選択して文字入力(上限は140文字)。
  ・テキストエリア下のツールバーの各ボタンを押すことで、書式の変更が行えます(全体に一括してかかります)。

  また、並び替えに戻りたい時は、「並び替えに戻る」ボタンを押します。この時、入力途中のものは削除されませんので、安心して選択してください。

<br>
  満足したところで、「行動を終える」ボタンを押し、次プレイヤーにバトンタッチします。

<br>
<br>

  ## 後行プレーヤーのターン
  後行のプレイヤーも、先行のプレイヤーと同じ流れでプレイします。
  
  後行プレイヤーが、コメントを添える画面で「行動を終える」ボタンを押した時に、判定に移ってよいかどうか確認するモーダルウィンドウが現れます。
  問題なければそのまま肯定し、判定画面に映ってください。

<br>

  ## 判定(発表)画面
  各プレーヤーが作った"文字"と”コメント”が発表されます。
  先行プレーヤーが上に、後行のプレーヤーが下に、アバターとともに縦に並んで表示されます。

<br>
<br>
<div display="flex" align="center">
  <img src="./public/image/result.png" width="40%">
</div>


<br>
<br>

## 投票する

「判定する」ボタンを押すことで、投票に移ります。<br>
勝敗は各プレイヤーの感覚に委ねられます。<br>

各プレイヤーに対し、勝敗を問うモーダルが表示されますので、正直にどちらが勝ったか答えて下さい。

<br>
<br>

最後に、結果の表示がされ、ゲーム終了となります。

<br>

お疲れ様でした！

<br>
<br>



***
<br>

  ## 制作で苦労した点

  - 素のJavaScriptの様々な書き方による、DOM取得時の細かい仕様の違いについて。<br>

    例えば、ここは .querySelectorAll()で取得しているので、戻り値がNodeListで返って来ていて…それを配列のようにループ処理するには…と、
    「これはこうだからこう処理する」というような部分が、感覚的に入ってくるまでに時間がかかりました。

    しかし、結果として、壁を感じた分、理解も進み、作り終える頃にはすっかり身に付ける事ができました。

  - 手順を考えること<br>

    複数のステップに渡るゲームアプリの制作は初めてだったため、
    要素の取得のタイミングや、表示の入り切り、ゲームの進行と処理の流れ（順番）を意識しながらコードを組み立てるのは、少し慣れるまで大変でした。<br>

    始めの段階ではイベントドリブンであることをしっかり意識することができなかったため、「えーと、ここで処理を一旦止めたいな...」という様に考えてしまっていました。<br>
    これも結果として、慣れる事が一番重要で、慣れるにつれて理解を深める事ができました。<br>


  - 再利用可能なコードを書く<br>

    再利用可能なコードを考えるのに、何度か書き直した場面が（多く）ありました。<br>
    しかしそれは、可読性をよくし、さらに整理して書き足すことや、複数プレイヤーでのプレイや拡張性を想定するのに必要なポイントでした。

    どこからどこまでを、どう分けていくかがとても難しく感じましたが、今後も考えていく事でより良いコードが書ける様になりたいと考えています。

<br>

***
<br>

  ## 工夫した点

  - 濁点<br>
<br>
  濁点、半濁点、小文字への変換をできるようにしました。

<br>

  - スクロールの制御  => 反省点に続く<br>

    ゲームの場面進行（画面の遷移）を縦スクロールによって実装したため、いくつかの問題を解決する必要がありました<br>
<br>
     縦スクロールでの実装に伴う問題点について
    - ユーザーがスクロールすることで、見せたくない部分が見れてしまう。
    （先行するユーザーの完成したカードを見れてしまう、など。）<br>
    - ユーザーがブラウザをリサイズすると、スクロール位置が縦にずれ、境界部分が見えてしまう
    <br>
    それらを防ぐため、３つのスクロールに関する関数(機能)を用意しましたが、<br>
    それぞれバッティングさせないように組むのに、少し工夫が必要でした。<br><br>
    <br>
    1. 普通に、次の場面の位置まで遷移する処理。<br>
    2. リサイズを検知して、ズレたスクロール位置を戻す処理。<br>
    3. スクロールを検知して、いるべき場所にスクロール位置を戻す処理。<br>
    <br>
    具体的には、以下の工夫をしました。<br>
    2,3 => スクロールイベントを制御するsetTimeoutの値の微妙な調整(クリックイベントやウィンドウのリサイズで走るスクロールとのバッティングの回避)、<br>
    1,3 => リサイズなどに合わせてウィンドウの切り替え位置を動的に決め直す。<br>
    <br>



  ### 反省点

  - そもそも、縦スクロールで実装すべきだったのか

    これは後で気付いた反省点になりますが、

    <b>「そもそも"縦スクロール"で場面転換するのが相応しかったのか」</b>

    という疑問、いや、反省点が出てきました。

    改善案としては、グローバル変数でゲーム状態を制御し、このように↓用意したHTMLを入れ替えた方がシンプルだったのではないか。<br>

    ```const 1stStage = `<section class="first-stage">....` ```


    そもそもの設計は本当に大事だと、教訓を得ました。<br>

    この反省は、次回に生かしたいと思います。

***

<br>

  ## 今後実装・修正予定の箇所


   ### 実装予定
  - ~~濁点・半濁点について~~　=> 実装済み:new:<br>
      <details><summary>...</summary>
    → ~~別の文字として元のカードに混ぜるか、並べ替えの際に自由に付けられるようにするか迷っていたため未実装。<br>
       濁点なしのひらがなに付加する形で実装予定。~~
      </details>

  - （PC向け）スクロール(シーン切り替え)による細かい表示の振り分け。

      初めのページ→リスト表示、２ページ以降→ハンバーガー表示<br>
    <details><summary>...</summary>
    → PCのみ、一部スクロールの位置で表示を変えるようにしたい。
    </datails>

  - nav > ルール の内容を入れる<br>
    <details><summary>...</summary>
    → <br>
    1. 「現在制作中」のままなので内容を入れる。<br>
    2. ゲーム中、”簡単に”ルールを参照できるようにする。<br>
    尚、内容はゲームの進行度合いに合わせて表示を変える仕様にする。
    </details>

  - もう一周！<br>
    ゲーム終了後、続けてゲームをできるようにする。<br>
    <br>

  ### 修正予定

  - ~~並び替えの際に、同じカードを二枚並べることができてしまうので、要修正。~~
    →修正済み

  - ~~初めの画面のインフォメーションとカードの選択との兼ね合いが一部崩れるため、バグフィックス。~~
    →修正済み

  - ~~アニメーションの部分を、Promiseを用いた順次処理の形に書き換える。~~
    →修正済み

<br>

***
<br>
:copyright: MasatoYamada

